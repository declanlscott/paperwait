---
import * as v from "valibot";

import PapercutAuthToken from "~/components/papercut/auth-token.astro";
import { Registration } from "~/shared/lib/schemas";

import type { PapercutAuthTokenProps } from "~/types/astro-component-props";

export const partial = true;

const formData = await Astro.request.formData();

const { authToken: value } = v.parse(
  v.fallback(v.object({ authToken: Registration.entries.authToken }), {
    authToken: "",
  }),
  Object.fromEntries(formData.entries()),
);

const show = v.parse(
  v.fallback(v.boolean(), false),
  Astro.url.searchParams.get("show") === "true",
);

const props = { value, show } satisfies PapercutAuthTokenProps;
---

<PapercutAuthToken {...props} />
