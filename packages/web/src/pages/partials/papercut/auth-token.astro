---
import { Registration } from "@paperwait/core/schemas";
import { validate } from "@paperwait/core/valibot";
import * as v from "valibot";

import PapercutAuthToken from "~/components/papercut/auth-token.astro";

import type { PapercutAuthTokenProps } from "~/components/props";

export const partial = true;

const formData = await Astro.request.formData();

const { authToken: value } = validate(
  v.fallback(v.object({ authToken: Registration.entries.authToken }), {
    authToken: "",
  }),
  Object.fromEntries(formData.entries()),
);

const show = validate(
  v.fallback(v.boolean(), false),
  Astro.url.searchParams.get("show") === "true",
);

const props = { value, show } satisfies PapercutAuthTokenProps;
---

<PapercutAuthToken {...props} />
