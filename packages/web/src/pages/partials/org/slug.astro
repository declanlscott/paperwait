---
import { fn } from "@paperwait/core/valibot";
import * as v from "valibot";

import { isOrgSlugValid } from "~/api/lib/organization";
import OrgSlug from "~/components/org/slug.astro";
import { Registration } from "~/shared/lib/schemas";

import type { Props } from "~/components/org/slug.astro";

export const partial = true;

const formData = await Astro.request.formData();

const props: Props = await fn(
  v.object({ slug: Registration.entries.slug }),
  async ({ slug }) => {
    const isValid = await isOrgSlugValid(slug);

    return { value: slug, isValid };
  },
)(Object.fromEntries(formData.entries()));
---

<OrgSlug {...props} />
