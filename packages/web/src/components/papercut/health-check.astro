---
import LoadingIndicator from "~/components/loading-indicator.astro";
import { buttonStyles } from "~/styles/components/primitives/button";

import type { PapercutHealthCheckProps } from "~/components/props";

type Props = PapercutHealthCheckProps;

const props = Astro.props;
---

<div id="health-check" class="grid gap-2">
  <button class={buttonStyles({ class: "gap-2", isHtml: true })} type="submit">
    <div id="status-indicator" class="loading-indicator">
      <div class="size-5 flex items-center">
        <LoadingIndicator color="#fff" />
      </div>
    </div>

    {
      props.status === "success" && (
        <svg
          id="status-indicator"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="health-check-indicator text-green-400 size-5"
        >
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
          <path d="m9 11 3 3L22 4" />
        </svg>
      )
    }

    {
      props.status === "error" && (
        <svg
          id="status-indicator"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="heatlh-check-indicator text-red-500 size-5"
        >
          <path d="M18 6 6 18" />
          <path d="m6 6 12 12" />
        </svg>
      )
    }

    Health Check
  </button>

  {
    props.status === "success" && (
      <p class="text-green-700 text-sm">Health check successful!</p>
    )
  }

  {
    props.status === "error" && (
      <p class="text-red-500 text-sm">{props.reason}</p>
    )
  }
</div>

<style>
  .loading-indicator {
    display: none;
  }

  .htmx-request .loading-indicator {
    display: inline;
  }

  .htmx-request.loading-indicator {
    display: inline;
  }

  .htmx-request.health-check-indicator {
    display: none;
  }
</style>
